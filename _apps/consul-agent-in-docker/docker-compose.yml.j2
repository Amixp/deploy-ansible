{{ srv_name }}:
  image: "{{ docker_image }}"
  user: "{{ deploy_user.stat.uid }}:{{ deploy_user.stat.gid }}"
  net: "host"
  ports:
    - "8300:8300"
    - "8301:8301"
    - "8301:8301/udp"
    - "8302:8302"
    - "8302:8302/udp"
    - "8400:8400"
    - "8500:8500"
    - "8600:8600"
    - "8600:8600/udp"
  environment:
    DATACENTER: "{{ consul.dc }}"
    EXTERNAL_IP: "{{ ansible_default_ipv4.address }}"
    CLIENT_ADDR: "0.0.0.0"
    TOKEN: "{{ consul.token }}"
  volumes:
    - "{{ deploy_user.stat.path }}/data:/var/consul"
    - "{{ deploy_user.stat.path }}/config:/etc/consul"
  command: "consul agent -config-dir /etc/consul{% if dont_join is undefined %} -join {{ consul.first_node_ip }}{% endif %}"
